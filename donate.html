<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Keep all your existing head content -->
    <!-- Add PesaPal script in the head -->
    <script src="https://www.pesapal.com/api/PostPesapalDirectOrderV4" type="text/javascript"></script>
</head>
<body>
    <!-- Keep all your existing navigation and header content -->

    <!-- Payment Methods Tabs - UPDATED VERSION -->
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <ul class="nav nav-tabs justify-content-center mb-4" id="donationTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="mobile-tab" data-bs-toggle="tab" data-bs-target="#mobile" type="button">
                        <i class="fas fa-mobile-alt me-2"></i>Mobile Money
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="bank-tab" data-bs-toggle="tab" data-bs-target="#bank" type="button">
                        <i class="fas fa-university me-2"></i>Bank Transfer
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pesapal-tab" data-bs-toggle="tab" data-bs-target="#pesapal" type="button">
                        <i class="fas fa-credit-card me-2"></i>PesaPal (Cards/Mobile)
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="paypal-tab" data-bs-toggle="tab" data-bs-target="#paypal" type="button">
                        <i class="fab fa-paypal me-2"></i>PayPal/Card
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="donationTabsContent">
                <!-- Mobile Money - Keep your existing mobile money content -->
                
                <!-- Bank Transfer - Keep your existing bank transfer content -->
                
                <!-- NEW PesaPal Tab -->
                <div class="tab-pane fade" id="pesapal" role="tabpanel">
                    <div class="row justify-content-center">
                        <div class="col-lg-6">
                            <div class="payment-option p-4 floating-animation">
                                <h3 class="text-center mb-4"><i class="fas fa-credit-card text-gold me-2"></i>PesaPal Payment</h3>
                                <p class="text-center mb-4">Secure payment via credit card, debit card, or mobile money</p>
                                
                                <div class="mb-4">
                                    <label class="form-label">Donation Amount (USD)</label>
                                    <div class="btn-group w-100 mb-3" role="group">
                                        <button type="button" class="btn btn-outline-secondary pesapal-amount active" data-amount="25">$25</button>
                                        <button type="button" class="btn btn-outline-secondary pesapal-amount" data-amount="50">$50</button>
                                        <button type="button" class="btn btn-outline-secondary pesapal-amount" data-amount="100">$100</button>
                                    </div>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control" id="pesapalCustomAmount" placeholder="Other amount" min="1">
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="pesapalFirstName" class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="pesapalFirstName" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="pesapalLastName" class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="pesapalLastName" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="pesapalEmail" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="pesapalEmail" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="pesapalPhone" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="pesapalPhone" required>
                                </div>
                                
                                <button id="pesapal-payment-button" class="btn btn-gold w-100">
                                    <i class="fas fa-lock me-2"></i>Proceed to Secure Payment
                                </button>
                                
                                <div class="text-center mt-3">
                                    <img src="https://www.pesapal.com/wp-content/uploads/2020/08/pesapal-partner-logos.png" alt="PesaPal payment options" class="img-fluid" style="max-width:300px">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- PayPal - Keep your existing PayPal content -->
            </div>
        </div>
    </div>

    <!-- Keep all your existing impact section and footer -->

    <!-- Updated Script Section -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_CLIENT_ID&currency=USD"></script>
    <script>
        // Set current year in footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // PesaPal integration
        document.addEventListener('DOMContentLoaded', function() {
            // PesaPal amount selection
            const pesapalAmountButtons = document.querySelectorAll('.pesapal-amount');
            pesapalAmountButtons.forEach(button => {
                button.addEventListener('click', function() {
                    pesapalAmountButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById('pesapalCustomAmount').value = this.dataset.amount;
                });
            });

            // PesaPal custom amount handling
            document.getElementById('pesapalCustomAmount').addEventListener('input', function() {
                pesapalAmountButtons.forEach(btn => btn.classList.remove('active'));
            });

            // PesaPal payment button handler
            document.getElementById('pesapal-payment-button').addEventListener('click', function() {
                const amount = document.getElementById('pesapalCustomAmount').value || 
                              document.querySelector('.pesapal-amount.active').dataset.amount;
                const firstName = document.getElementById('pesapalFirstName').value;
                const lastName = document.getElementById('pesapalLastName').value;
                const email = document.getElementById('pesapalEmail').value;
                const phone = document.getElementById('pesapalPhone').value;
                
                if (!firstName || !lastName || !email || !phone || !amount) {
                    alert('Please fill in all required fields');
                    return;
                }

                initiatePesapalPayment(amount, firstName, lastName, email, phone);
            });
        });

        function initiatePesapalPayment(amount, firstName, lastName, email, phone) {
            // PesaPal API credentials
            const consumerKey = '2wox6FcqZuKDvXKiIY0oay2mDoiDhnPa';
            const consumerSecret = 'u1VQmY/clDp5pz5TqcdlPvKsgxI=';
            
            // Generate a unique reference
            const reference = 'ASFA-' + Date.now();
            
            // Payment details
            const desc = "Donation to ASFA Foundation";
            const callbackUrl = "https://armstretchfoundationafricaltd.org/donate.html"; // Update with your actual callback URL
            
            // Create the request
            const params = {
                Amount: amount,
                Description: desc,
                Type: "MERCHANT",
                Reference: reference,
                FirstName: firstName,
                LastName: lastName,
                Email: email,
                PhoneNumber: phone,
                Currency: "USD",
                CallBackURL: callbackUrl
            };
            
            // Initialize PesaPal
            Pesapal.initialize({
                credentials: {
                    consumer_key: consumerKey,
                    consumer_secret: consumerSecret
                },
                environment: "production" // or "sandbox" for testing
            });
            
            // Submit the order
            Pesapal.submitOrder({
                params: params,
                onSuccess: function(response) {
                    console.log("PesaPal success:", response);
                    // Redirect to PesaPal payment page
                    window.location.href = response.redirect_url;
                },
                onError: function(error) {
                    console.error("PesaPal error:", error);
                    alert("Error initiating payment. Please try again.");
                }
            });
        }

        // Keep your existing PayPal integration code
    </script>
</body>
</html>
